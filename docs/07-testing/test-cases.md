# Test Cases — Набор тестовых сценариев для InvestCalc

Документ содержит основные тест-кейсы для проверки бизнес-логики и API.

---

## 1. Формат описания тест-кейса

- ID
- Название
- Предусловия
- Шаги
- Ожидаемый результат
- Уровень (Unit / API)

---

## 2. Тесты для базового расчёта (calculate)

### TC-01 — Позитивный расчёт, проект окупается

- **ID:** TC-01  
- **Уровень:** Unit + API  
- **Предусловия:** сервис доступен  
- **Шаги:**
  1. Вызвать `calculate_all` с:
     - `capex = 100000`
     - `opex = 20000`
     - `period = 5`
     - `effect = 40000`
  2. Или отправить POST `/api/v1/calculate` с теми же данными.
- **Ожидаемый результат:**
  - `tco = 100000 + 20000*5 = 200000`
  - `effect_total = 40000*5 = 200000`
  - `roi = 0%` или около 0 (в зависимости от формулы, см. business-rules.md)
  - `payback` корректно рассчитан (если логика подразумевает окупаемость).
  - `is_profitable` определяется согласно BR-04.

---

### TC-02 — Проект не окупается (effect слишком мал)

- **ID:** TC-02  
- **Шаги:**
  1. Вызвать расчёт с:
     - `capex = 300000`
     - `opex = 80000`
     - `period = 3`
     - `effect = 20000`
- **Ожидаемый результат:**
  - `(effect * period) < TCO`;
  - `is_profitable = false`;
  - `payback = null` (согласно бизнес-правилу BR-03).

---

### TC-03 — Нулевой CAPEX и OPEX

- **ID:** TC-03  
- **Шаги:** передать `capex = 0`, `opex = 0`, `effect > 0`.
- **Ожидаемый результат:**
  - корректная обработка (нет деления на ноль);
  - `roi` обрабатывается согласно BR-02;
  - система не падает.

---

## 3. Тесты анализа чувствительности

### TC-10 — Генерация трёх вариантов (low/base/high)

- **ID:** TC-10  
- **Уровень:** Unit  
- **Шаги:**
  1. Вызвать `sensitivity_analysis` с базовыми данными.
- **Ожидаемый результат:**
  - 3 варианта для параметра (например, capex):
    - `low = capex * 0.8`
    - `base = capex`
    - `high = capex * 1.2`
  - Для каждого рассчитаны TCO/ROI/Payback.

---

### TC-11 — Стабильность при крайне больших значениях

- **ID:** TC-11  
- **Шаги:** вызвать анализ чувствительности с `capex = 1e9`, `opex = 1e8`, `effect = 5e8`.
- **Ожидаемый результат:**
  - нет исключений overflow;
  - корректные числовые результаты.

---

## 4. Тесты сравнения сценариев

### TC-20 — Выбор лучшего сценария по ROI

- **ID:** TC-20  
- **Уровень:** Unit + API  
- **Предусловия:** доступны два сценария (local, cloud).  
- **Шаги:**
  1. Подготовить два набора данных с разными ROI.
  2. Вызвать `compare_scenarios` или GET `/api/v1/compare`.
- **Ожидаемый результат:**
  - `recommended` указывает сценарий с большим ROI;
  - `justification` содержит текстовое обоснование.

---

### TC-21 — Равные ROI, сравнение по TCO

- **ID:** TC-21  
- **Шаги:**  
  Задать два сценария с одинаковым ROI, разным TCO.
- **Ожидаемый результат:**
  - применяется правило BR-08 (TCO как второй критерий);
  - выбран сценарий с меньшим TCO.

---

## 5. Тесты API-валидации

### TC-30 — Отрицательный CAPEX

- **ID:** TC-30  
- **Уровень:** API  
- **Шаги:**
  1. Отправить POST `/api/v1/calculate` с `capex = -100`.
- **Ожидаемый результат:**
  - HTTP 400 или 422;
  - в теле ответа есть ошибка по полю `capex`.

---

### TC-31 — Нулевой период

- **ID:** TC-31  
- **Шаги:** `period = 0`.
- **Ожидаемый результат:**
  - ошибка валидации;
  - понятное сообщение.

---

## 6. Тесты отчёта

### TC-40 — Успешная генерация HTML-отчёта

- **ID:** TC-40  
- **Уровень:** API  
- **Шаги:**
  1. Выполнить необходимые расчёты (либо отчёт генерирует всё сам).
  2. Вызвать `/api/v1/report`.
- **Ожидаемый результат:**
  - код 200;
  - `Content-Type: text/html`;
  - в HTML присутствуют:
    - блок исходных данных,
    - блок расчётов,
    - блок чувствительности (если включён),
    - блок выводов.

 