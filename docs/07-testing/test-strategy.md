# Стратегия тестирования проекта InvestCalc

## 1. Введение

Данный документ определяет стратегию тестирования учебного проекта **InvestCalc**, который реализует расчёт экономической эффективности информационных систем (TCO, ROI, Payback Period, анализ чувствительности).
Цель стратегии — описать подходы, уровни, методы и инструменты тестирования, а также определить, как результаты проверки связываются с требованиями, архитектурой, API и DevOps-процессами.

---

## 2. Цели тестирования

Основные цели тестирования:

* проверить корректность расчётов (TCO, ROI, PP);
* убедиться, что API работает стабильно и возвращает ожидаемые ответы;
* выявить ошибки на ранних этапах разработки;
* поддерживать качество кода через автоматизацию CI/CD;
* обеспечить прозрачность результатов для отчётности и преподавателя.

---

## 3. Объекты тестирования

В рамках проекта тестируются:

| Объект              | Описание                                                   |
| ------------------- | ---------------------------------------------------------- |
| **Доменная логика** | функции расчёта TCO, ROI, Payback, анализ чувствительности |
| **API**             | эндпоинты FastAPI, валидация данных, коды ошибок           |
| **Модель данных**   | корректность входных структур                              |
| **Интеграция**      | взаимодействие модулей между собой                         |
| **Документация**    | успешная сборка MkDocs (`mkdocs build --strict`)           |
| **DevOps-конвейер** | корректность выполнения пайплайна CI/CD                    |

---

## 4. Уровни тестирования

### 4.1. Модульное тестирование

Проверяется:

* корректность расчётов:

  * `tco(capex, opex, period)`
  * `roi(capex, opex, effects)`
  * `payback(cashflows)`
  * анализ чувствительности ±20%;
* обработка ошибок (деление на ноль, отрицательные параметры).

Используемые инструменты:

* `pytest`
* `pytest-asyncio` (при необходимости)

---

### 4.2. Интеграционное тестирование

Проверяется связное поведение компонент:

* API → доменная логика → JSON-ответ;
* обработка ошибок валидации (422);
* последовательные операции (например расчёты для разных сценариев).

Инструменты:

* `pytest`
* `httpx.AsyncClient` для тестирования FastAPI.

---

### 4.3. API-тестирование

Проверяются:

* структура запросов и ответов;
* соответствие OpenAPI-схеме;
* корректные коды ответов;
* работа Swagger и ReDoc.

Связанные документы:

➡️ [API — обзор](../05-api/api-overview.md)
➡️ [Эндпоинты InvestCalc](../05-api/endpoints-invest.md)
➡️ [Коды ошибок](../05-api/errors-and-status-codes.md)

---

### 4.4. Нефункциональное тестирование

Проверяется:

* производительность API (< 200 ms на обработку запроса);
* корректность ответа при большом количестве сценариев;
* устойчивость к ошибкам пользователя.

---

## 5. Методы тестирования

* **Статическое тестирование:** линтеры (ruff, black) и SAST.
* **Динамическое тестирование:** запуск модульных, интеграционных и API-тестов.
* **Сравнение с эталонными расчётами:** заранее подготовленные таблицы.
* **Граничный анализ:**

  * CAPEX = 0
  * OPEX = 0
  * отрицательные значения
  * очень большие числа

---

## 6. Инструменты тестирования

| Инструмент         | Назначение                       |
| ------------------ | -------------------------------- |
| **pytest**         | модульные и интеграционные тесты |
| **httpx**          | тестирование FastAPI эндпоинтов  |
| **pytest-cov**     | покрытие кода тестами            |
| **ruff / black**   | линтинг и форматирование         |
| **bandit**         | анализ уязвимостей               |
| **safety**         | проверка зависимостей            |
| **GitHub Actions** | автоматизация тестов и деплоя    |

---

## 7. Автоматизация тестирования в CI/CD

Все тесты выполняются автоматически в GitHub Actions при:

* `push` в ветку **main**;
* создании Pull Request.

Полный пайплайн описан в:

➡️ [CI/CD — структура GitHub Actions](../08-devops/ci-cd.md)

## В CI/CD выполняются этапы:

* матричные тесты (`pytest`);
* линтинг (`ruff`, `black --check`);
* проверка безопасности (`bandit`, `safety`);
* сборка документации (`mkdocs build --strict`);
* сборка и публикация Docker-образа.

Ошибки на любом этапе останавливают пайплайн.

---

## 8. Трассируемость требований и тестов

Каждое требование из `requirements-spec.md` должно иметь тесты:

---

**TR-01**: Расчёт TCO → тесты `test_tco.py`
**TR-02**: Расчёт ROI → тесты `test_roi.py`
**TR-03**: Анализ чувствительности → тесты `test_sensitivity.py`
**TR-04**: API эндпоинты → тесты `test_api_*.py`
**TR-05**: Коды ошибок → тесты API ошибок
--------------------------------------------

Связанный документ:

➡️ [Спецификация требований](../02-requirements/requirements-spec.md)

---

## 9. Требования к тестовой отчётности

Результаты тестирования отражаются в разделе отчёта:

➡️ [Структура итогового отчёта](../09-report/report-structure.md)

В отчёте должны присутствовать:

* примеры запросов и ответов API;
* скриншоты Swagger/ReDoc;
* таблицы **до/после**;
* результаты `pytest`;
* выдержки из CI/CD;
* диаграммы покрытия (опционально).

 