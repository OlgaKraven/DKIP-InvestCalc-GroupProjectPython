# Security — Безопасность, обработка ошибок и защита API InvestCalc

Документ описывает:

- базовые принципы безопасности,
- валидацию данных,
- обработку ошибок,
- рекомендации по безопасному расширению API.

---

## 1. Уровень безопасности проекта

InvestCalc — учебный проект, поэтому система:

- **не содержит аутентификации**,  
- **не содержит БД**,  
- **не хранит пользовательские данные**.

Однако минимальные требования безопасности соблюдаются.

---

## 2. Валидация данных (основа безопасности)

Через Pydantic-модели проверяются:

- типы данных;
- ограничения (`ge=0`, `period>=1`);
- наличие обязательных полей;
- формат JSON.

Ошибки:

- `422 Unprocessable Entity` — ошибки схемы;
- `400 Bad Request` — ошибки бизнес-логики.

---

## 3. Обработка ошибок

Используется глобальный обработчик в FastAPI:

```python
@app.exception_handler(Exception)
async def global_handler(request, exc):
    return JSONResponse(
        status_code=500,
        content={"error": "Internal server error"}
    )
```

Требования:

* не раскрывать stacktrace пользователю;
* логировать ошибки в консоль (Docker собирает их автоматически).

---

## 4. Формат ошибок API

Стандарт:

```json
{
  "error": "Invalid input",
  "details": [
    {
      "loc": ["capex"],
      "msg": "Value must be >= 0"
    }
  ]
}
```

---

## 5. CORS (по умолчанию отключён)

Если проект расширится до фронтенда:

```python
from fastapi.middleware.cors import CORSMiddleware
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_methods=["*"],
    allow_headers=["*"]
)
```

---

## 6. Безопасность HTML-отчёта

Требования:

* никакого пользовательского HTML-ввода;
* отчёт формируется только из доверенных данных;
* escaping обязателен при добавлении динамических данных.

---

## 7. Защита от небезопасных операций

Проект должен гарантировать:

* отсутствие выполнения внешнего кода;
* отсутствие зависимости от пользовательских путей (path traversal);
* доступ только к JSON-файлам внутри `data/`.

---

## 8. План расширения безопасности (если появится полноценная ИС)

* добавить авторизацию (JWT);
* RBAC для преподавателей/студентов;
* защита от rate limiting;
* HTTPS для прод-версии;
* SSO/LDAP для корпоративной версии;
* мониторинг авторизационных событий.

 

 
