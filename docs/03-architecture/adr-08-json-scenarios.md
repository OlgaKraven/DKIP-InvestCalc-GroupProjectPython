# ADR-08 — Хранение сценариев в JSON-файлах

Дата: 2025-01-01  
Статус: Принято

---

## 1. Контекст

Система InvestCalc использует два типа входных наборов данных:

- сценарий локальной инфраструктуры (on-premises),
- сценарий облачной инфраструктуры (SaaS).

Для учебных целей необходимо обеспечить:

- простое редактирование сценариев,
- возможность хранения нескольких примеров,
- лёгкое подключение к API,
- отсутствие необходимости в БД,
- быстрый доступ к данным из сервисного слоя,
- возможность расширять набор сценариев.

Нужно выбрать **формат хранения этих сценариев**:

- JSON  
- YAML  
- CSV  
- база данных  
- Python-объекты  
- Excel  

---

## 2. Решение

Принято решение использовать:

## ✔ **JSON-файлы (`*.json`) в каталоге `data/`**  
как основной формат хранения сценариев.

Файлы расположены в:

```

data/
├── input-local.json
├── input-cloud.json
└── samples/
├── scenario1.json
└── scenario2.json

```

---

## 3. Обоснование

## 3.1. Простота формата
JSON:
- читается всеми языками,
- имеет фиксированную структуру,
- легко валидируется,
- прост для студентов.

## 3.2. Прямая интеграция с FastAPI
FastAPI работает natively:
- с JSON-телами,
- с Pydantic моделями,
- с сериализацией/десериализацией.

## 3.3. Не требуется база данных
Для учебного проекта БД усложняет инфраструктуру:
- требует миграций,
- окружения SQL,
- сетевых настроек.

JSON идеально подходит для статических сценариев.

## 3.4. Масштабируемость
Набор сценариев легко расширять:
- добавлять новые файлы,
- сортировать их по папкам,
- делиться с другими студентами.

## 3.5. Удобство работы в GitHub
JSON-файлы:

- версионируются,
- легко видеть diff,
- легко обновлять через PR,
- удобно комментировать.

---

## 4. Альтернативы

## 4.1. YAML
**Отклонено**  
Причины:
- более сложный синтаксис,
- ошибки отступов для студентов,
- нет стандартной автодокументации.

## 4.2. CSV
**Отклонено**  
Причины:
- плоская структура,
- неудобен для вложенных структур данных.

## 4.3. Excel / Google Sheets
**Отклонено**  
Причины:
- требует дополнительных библиотек,
- сложно в CI/CD,
- тяжело дифферентировать изменения.

## 4.4. База данных (PostgreSQL, SQLite)
**Отклонено для текущего проекта, возможно позже**  
Причины:
- избыточная сложность,
- не соответствует статeless-архитектуре ADR-06.

## 4.5. Python-объекты (dict)
**Отклонено**  
Причины:
- нельзя хранить в Git в удобном виде,
- нет стандартизированного формата.

---

## 5. Последствия

## Положительные:
- простое обслуживание,
- отличная совместимость с FastAPI,
- удобная работа с Git,
- отсутствие зависимости от БД,
- предсказуемая структура данных,
- лёгкое чтение/загрузка сценариев.

## Негативные:
- нет динамического обновления сценариев (без редактирования файлов),
- нет транзакций,
- отсутствует централизованное хранилище (необходимо вручную синхронизировать файлы).

---

## 6. Формат сценария (пример)

```json
{
  "capex": 500000,
  "opex": 120000,
  "period": 5,
  "effect": 250000
}
```

---

## 7. Использование в коде

## Загрузка сценария

```python
def load_scenario(path: str) -> InvestmentInput:
    with open(path, "r") as f:
        data = json.load(f)
    return InvestmentInput(**data)
```

## Применение:

```python
local = load_scenario("data/input-local.json")
cloud = load_scenario("data/input-cloud.json")
```

---

## 8. Связанные ADR

* ADR-01 — Технологический стек
* ADR-03 — Структура каталогов
* ADR-05 — Сервисный слой
* ADR-06 — Stateless Architecture
* ADR-07 — Модуль отчётности
