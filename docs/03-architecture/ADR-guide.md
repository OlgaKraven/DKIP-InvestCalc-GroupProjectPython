# Руководство по созданию Architecture Decision Records (ADR)

### 1. Назначение документа

Этот документ объясняет:

* что такое ADR (Architecture Decision Record),
* зачем они нужны в командной разработке,
* как писать ADR в формате MADR,
* как вести систему связанных архитектурных решений,
* как оформлять ADR в рамках проекта InvestCalc,
* какие стандарты использовать (ГОСТ, ISO, RFC).

---

## 2. Что такое ADR?

ADR (Architecture Decision Record) — это короткий, но формальный документ, фиксирующий одно архитектурное решение:

* *какую проблему мы решаем*,
* *какие альтернативы рассматривали*,
* *какое решение приняли*,
* *почему*,
* *какие последствия*,
* *как это влияет на архитектуру*.

ADR — это «история мыслей команды».
Любой новый участник проекта может понять *почему* структура, технологии и подходы именно такие.

---

#### Почему ADR критически важны в учебных проектах?

#### Студенты учатся принимать технические решения

Не просто писать код, а обосновывать архитектуру.

#### Позволяют преподавателю быстро проверять качество решений

#### Дают команде единый язык

Все понимают, *как проект устроен и почему*.
#### Умение вести ADR — обязательный навык в DevOps, архитектуре и enterprise-разработке

---
 3. Когда создавать ADR

ADR пишут обязательно, если принимается решение, влияющее на архитектуру:

* выбор архитектурного стиля (монолит/модули/микросервисы),
* структура проекта,
* выбор технологий (FastAPI, PostgreSQL, Docker),
* стратегия тестирования,
* ошибка/логирование/безопасность,
* схема API и его ошибок,
* CI/CD pipeline,
* принцип работы вычислительного ядра.

#### Минимальный набор ADR для любого учебного проекта:

* ADR архитектурного стиля
* ADR структуры каталогов
* ADR дизайна API
* ADR обработки ошибок
* ADR логирования
* ADR безопасности
* ADR CI/CD
* ADR Docker

---

## 4. Формат MADR (Modern ADR) — рекомендуемый формат

Структура MADR:

```
#### ADR-XX: Название решения

## 1. Контекст и постановка задачи
Чем вызвана необходимость решения?

#### 2. Факторы принятия решения
Критерии выбора: производительность/простота/безопасность/стандарты.

#### 3. Рассматриваемые варианты
A — консервативный  
B — сбалансированный  
C — продвинутый  

#### 4. Принятое решение
Какой вариант выбран и почему?

#### 5. Положительные последствия
Что улучшает решение?

#### 6. Отрицательные последствия
Какие риски создаёт?

#### 7. Плюсы и минусы вариантов

#### 8. Связанные ADR
Список тщательно подобранных ссылок.

#### 9. Диаграмма (Mermaid)

#### 10. Ссылки и стандарты
ГОСТ / ISO / RFC / OWASP
```

---

## 5. Ключевые требования к ADR

### 1. Одно ADR = одно решение

Не смешиваем темы.
Нельзя: «Логирование + Обработка ошибок».

### 2. ADR должно быть самодостаточным

Человек, который впервые открыл ADR, должен:

* понять проблему;
* увидеть варианты;
* оценить мотивацию выбора;
* понять последствия.

### 3. Формат строгий

Не допускаются пустые разделы.
Если нет диаграммы — убираем заголовок.

### 4. Должны быть варианты решения

Минимум 3 варианта, даже если 2 из них заведомо проигрышные.

### 5. Должен быть раздел «Связанные ADR»

Чтобы сформировать архитектурную сеть.

### 6. Должна быть ссылка на стандарты

Минимум:

* ГОСТ 34.602–2020
* ISO/IEC/IEEE 42010
* ISO/IEC 25010
* OWASP TOP 10
* RFC 7231 (если про API)

---

### 6. Пример идеально оформленного ADR (краткая версия)

```markdown
## ADR-12: Обработка ошибок API

## 1. Контекст и постановка задачи
API InvestCalc должен возвращать стандартизированные ошибки...

## 2. Факторы
- требования RFC 7807;
- единообразие клиентского опыта;
- простота для тестирования.

## 3. Варианты
A — Возвращать сырые исключения  
B — Стандартизированная JSON-ошибка  
C — Собственная схема ошибок  

## 4. Принятое решение
Вариант B — JSON-ошибка в формате RFC 7807...

## 5. Положительные последствия
- единый формат ошибок;
- удобство логирования.

## 6. Отрицательные последствия
- требуется слой преобразования ошибок.

## 7. Связанные ADR
- ADR-07: Таксономия исключений…

## 9. Диаграмма (Mermaid)
flowchart TD
    API --> ErrorLayer --> JSONError

## 10. Стандарты
RFC 7807, RFC 7231
```

---

### 7. Как вести ADR в InvestCalc

#### Каталог:

```
docs/03-architecture/
 ├── adr-index.md
 ├── adr-01-architectural-vision-constraints.md
 ├── adr-02-architecture-style-modular-monolith.md
 ├── ...
 ├── adr-30-quality-model-iso-25010.md
```

#### Индекс ADR

`adr-index.md` должен быть живым:

* содержать список ADR,
* поддерживать актуальность,
* помогать навигации.

---

### 8. Как связать ADR с MkDocs

Добавить в `mkdocs.yml`:

```yaml
- Архитектурные решения (ADR):
    - Обзор ADR: docs/03-architecture/adr-index.md
    - ADR-01: Архитектурное видение: docs/03-architecture/adr-01-architectural-vision-constraints.md
    - ...
```

Обязательно соблюдать порядок — ADR формируют логическую цепочку.

---

### 9. Требования преподавателя / проверяющего

По этому гиду можно ставить баллы:

#### ADR должно содержать:

* постановку задачи
* варианты
* принятые решения
* последствия
* связи с другими ADR
* ссылки на стандарты

#### ADR должно быть логически связано с другими

Архитектура — не набор случайных решений.

#### ADR должно быть написано корректным техническим языком

Без разговорных выражений.

---

### 10. Дополнительные материалы

* [MADR](https://adr.github.io/madr/) — официальный формат
* [Nygard ADR](https://cognitect.com/blog/2011/11/15/documenting-architecture-decisions.html)
* ГОСТ 34.602–2020
* ISO/IEC/IEEE 42010
* ISO/IEC 25010
* OWASP API Security TOP 10
* RFC 7231
* RFC 8259
