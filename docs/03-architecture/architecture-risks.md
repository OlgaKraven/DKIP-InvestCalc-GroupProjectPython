# Architecture Risks — Архитектурные риски InvestCalc и меры снижения

Документ описывает основные архитектурные риски проекта InvestCalc, их влияние на систему и стратегии минимизации.  
Фокус — на тех рисках, которые связаны с выбранной архитектурой, стеком и организацией проекта.

---

## 1. Назначение документа

Цель:

- выявить ключевые архитектурные риски,
- оценить их вероятность и влияние,
- предложить меры снижения (mitigation),
- зафиксировать осознанные архитектурные компромиссы.

Документ дополняет:

- `architecture-overview.md`
- `architecture-decisions.md`
- ADR-01 … ADR-14

---

## 2. Шкала оценки рисков

Для каждого риска указываются:

- **Вероятность (P)**:
  - Н — низкая
  - С — средняя
  - В — высокая
- **Влияние (I)**:
  - Н — низкое
  - С — среднее
  - В — высокое

---

## 3. Обзор архитектурных рисков

Краткая таблица:

| ID   | Риск                                           | P | I |
|------|------------------------------------------------|---|---|
| AR-01| Ошибки в расчётах (математика/формулы)         | С | В |
| AR-02| Неправильная или неполная валидация данных     | С | В |
| AR-03| Отсутствие БД (только JSON)                    | Н | С |
| AR-04| Ограниченный UI (Swagger + отчёт)              | С | С |
| AR-05| Невозможность масштабирования при росте нагрузок| Н | С |
| AR-06| Недостаточное логирование и мониторинг         | С | С |
| AR-07| Зависимость от Docker и CI/CD-инфраструктуры   | С | С |
| AR-08| Рост сложности при расширении (UI/БД/микросервисы) | С | С |
| AR-09| Человеческий фактор в команде (несогласованная архитектура) | С | С |

Далее — подробно по каждому.

---

## 4. AR-01 — Ошибки в расчётах (формулы, бизнес-логика)

**Описание:**  
Неверная реализация формул TCO, ROI, Payback, сравнения сценариев или анализа чувствительности приведёт к неверным выводам и неверным отчётам.

- **Вероятность:** С  
- **Влияние:** В  

**Возможные причины:**

- неправильная формула;
- неверная реализация граничных случаев (деление на ноль, неокупаемость);
- ошибки в округлении;
- расхождения между кодом и бизнес-правилами.

**Меры снижения:**

- формализация логики в `business-rules.md` (уже сделано);
- покрытие формул юнит-тестами (`test_service.py`, `test_sensitivity.py`);
- тесты на граничные кейсы (нулевые значения, очень большие/малые значения);
- ревью кода с участием преподавателя/тимлида;
- сверка с эталонной моделью (например, Excel-шаблоном).

---

## 5. AR-02 — Неправильная / неполная валидация входных данных

**Описание:**  
Недостаточная валидация может привести к:

- падению сервиса;
- некорректным расчётам;
- экономическим показателям без смысла (отрицательный период, отрицательный CAPEX).

- **Вероятность:** С  
- **Влияние:** В  

**Возможные причины:**

- пропуск ограничений (например, `period >= 1`);
- ошибка в типах (строка вместо числа);
- игнорирование `null`/отсутствующих полей.

**Меры снижения:**

- использовать Pydantic-модели (ADR-04) с явными ограничениями (`Field(ge=0, ...)`);
- реализовать и протестировать обработку ошибок (ADR-11);
- покрыть API-тестами некорректные кейсы (`test_api.py`);
- добавить документацию по структуре данных (`data-requirements.md`).

---

## 6. AR-03 — Отсутствие БД (только JSON-файлы)

**Описание:**  
В базовой версии сценарии хранятся в JSON-файлах. Это упрощает архитектуру, но:

- нет истории изменений сценариев на уровне системы;
- нет централизованного хранилища для многопользовательского режима;
- нет транзакций.

- **Вероятность:** Н  
- **Влияние:** С  

**Меры снижения:**

- чётко зафиксировать использование JSON как учебное решение (ADR-08);
- использовать Git как версионную систему для сценариев;
- при переходе к реальному использованию — ввести БД (см. ADR-14);
- изначально проектировать слой доступа к данным так, чтобы его можно было заменить.

---

## 7. AR-04 — Ограниченный UI

**Описание:**  
UI ограничивается Swagger/Redoc и HTML-отчётом. Это:

- снижает удобство для «нетехнических» пользователей;
- делает визуализацию ограниченной.

- **Вероятность:** С  
- **Влияние:** С  

**Меры снижения:**

- подробно описать ограничения в `ui-requirements.md`;
- обеспечить качественный HTML-отчёт (читаемый преподавателем);
- предусмотреть возможность расширения UI (ADR-14);
- при необходимости — разработать лёгкий фронтенд как отдельный этап.

---

## 8. AR-05 — Потенциальные проблемы масштабирования

**Описание:**  
Хотя архитектура stateless и масштабируемая, при высокой нагрузке возможны:

- задержки из-за одного контейнера;
- недостаточное количество воркеров Uvicorn;
- отсутствие балансировщика.

- **Вероятность:** Н (учебная нагрузка небольшая)  
- **Влияние:** С  

**Меры снижения:**

- зафиксировать стратегию масштабирования (ADR-12);
- использовать параметры `workers` при запуске Uvicorn;
- при реальном росте нагрузки — использовать Docker Compose scale / оркестратор;
- тестировать под нагрузкой (опционально).

---

## 9. AR-06 — Недостаточное логирование и мониторинг

**Описание:**  
Ошибки могут «прятаться» в системе, если нет логов и healthchecks.

- **Вероятность:** С  
- **Влияние:** С  

**Меры снижения:**

- включить базовое логирование (ADR-13);
- логировать все запросы и исключения;
- использовать Docker-логи;
- добавить простые healthchecks для контейнера;
- документировать подход к логированию в `devops/logging.md`, `devops/monitoring.md`.

---

## 10. AR-07 — Зависимость от Docker и CI/CD

**Описание:**  
Если Docker или GitHub Actions недоступны/неправильно настроены, студенты могут испытывать трудности с развёртыванием.

- **Вероятность:** С  
- **Влияние:** С  

**Меры снижения:**

- предоставить подробные инструкции (`devops/docker-instructions.md`, `ci-guide.md`);
- предусмотреть альтернативный запуск без Docker (локальный `uvicorn src.main:app` для отладки);
- использовать простой и прозрачный CI pipeline (без излишней сложности);
- обеспечить шаблон Dockerfile/compose файла в репозитории.

---

## 11. AR-08 — Усложнение архитектуры при расширении

**Описание:**  
При добавлении:

- БД,
- полноценного UI,
- микросервисов,

архитектура может стать значительно сложнее, чем изначальный учебный проект.

- **Вероятность:** С  
- **Влияние:** С  

**Меры снижения:**

- заранее зафиксировать путь расширения (ADR-14);
- соблюдать принципы модульности (отдельные слои: service, repository, ui, db);
- документировать новые решения через ADR (ADR-15+, новые файлы);
- сохранять упрощённую «базовую» ветку/версию проекта как учебную.

---

## 12. AR-09 — Человеческий фактор в командной архитектуре

**Описание:**  
Разные участники команды могут:

- по-разному понимать архитектуру;
- ослаблять разделение слоёв;
- дублировать функциональность.

- **Вероятность:** С  
- **Влияние:** С  

**Меры снижения:**

- использовать `architecture-overview.md` и `architecture-decisions.md` как «единый источник истины»;
- использовать ADR как обязательный формат фиксации решений;
- регулярно проводить код-ревью и архитектурные ревью;
- вести `team-rules.md` и `contribution-matrix.md` в `docs/10-team/`.

 
