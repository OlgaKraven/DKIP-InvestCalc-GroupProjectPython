# ADR-07 — Создание модуля генерации отчётов (HTML/PDF)

Дата: 2025-01-01  
Статус: Запланировано

---

## 1. Контекст

Учебный проект InvestCalc требует от студента:
- подготовки итогового аналитического отчёта,
- включения расчётов (TCO, ROI, Payback),
- включения анализа чувствительности,
- возможности экспорта в файл (HTML, PDF).

В текущей версии проект предоставляет только:
- REST API с расчётами,
- JSON-ответы.

Однако итоговая документация учебного проекта по ПИДИС требует:
- **готовый отчёт**, который может быть размещён в GitHub, загружен преподавателю или включён в презентацию.

Необходимо принять архитектурное решение:  
**Добавлять ли генератор отчётов в архитектуру и как реализовать его.**

---

## 2. Решение

Принято решение:

## ✔ Создать отдельный модуль **Report Generator**  
для генерации отчётов в формате:

- **HTML** (обязательно)
- **PDF** (опционально)

Модуль будет располагаться в:

```

src/services/report_service.py
templates/report_template.html

```

и вызываться из API через эндпоинт:

```

GET /api/v1/report

```

---

## 3. Обоснование решения

## 3.1. Требование учебного проекта
ПИДИС и групповая работа требуют:
- итогового отчёта,
- включения расчётов в документ,
- автоматизации формирования отчётности.

## 3.2. Отчёт должен быть самостоятельным артефактом
Преподаватель оценивает отчёт отдельно от API.

## 3.3. Использование уже существующих расчётов
Генератор отчётов использует:
- сервис расчётов,
- данные сценариев,
- результаты анализа.

## 3.4. Гибкость отчётности
HTML-отчёт:
- может быть открыт в браузере,
- легко экспортируется в PDF,
- может быть использован студентами для защиты проекта.

## 3.5. Простота реализации
FastAPI позволяет отдавать HTML через Jinja2-templates:
- минимум кода,
- высокая читаемость результата.

## 3.6. Возможность развития
Позволит добавить:
- диаграммы,
- инфографику,
- логотипы,
- таблицы сравнения,
- графики чувствительности.

---

## 4. Архитектурное место модуля

## Внутри C4-Component модели:

```

API → Report Service → Template → HTML/PDF

```

## Внутри каталога:

```

src/
└── services/
└── report_service.py
templates/
└── report_template.html

```

---

## 5. Альтернативы

## 5.1. Отчёт формируется вручную (студентом)
**Отклонено**  
Причины:
- не соответствует требованиям автоматизации,
- противоречит заданию группового проекта,
- нет воспроизводимости.

## 5.2. Только JSON, без HTML
**Отклонено**  
Причины:
- JSON неудобен для преподавателя,
- нельзя включить форматированный документ в отчёт.

## 5.3. Сразу PDF без HTML
**Отклонено**  
Причины:
- PDF-генерация сложнее,
- требует мощных библиотек,
- HTML даёт максимальную гибкость.

---

## 6. Последствия

## Положительные:
- наличие готового отчёта,
- автоматизация важного учебного артефакта,
- улучшение пользовательского опыта,
- возможность интеграции фронтендом,
- профессиональный подход.

## Негативные:
- требуется добавить шаблоны,
- требуется выделить сервис генерации,
- PDF-генерация может зависеть от сторонних библиотек.

---

## 7. Пример будущей реализации

## Вызов

```python
@router.get("/report")
def generate_report():
    return report_service.generate_html_report()
```

## Шаблон (пример)

```html
<!DOCTYPE html>
<html>
<head>
  <title>InvestCalc Report</title>
</head>
<body>
  <h1>Отчёт InvestCalc</h1>
  <h2>TCO: {{ tco }}</h2>
  <h2>ROI: {{ roi }}%</h2>
  <h2>Payback: {{ payback }}</h2>
</body>
</html>
```

---

## 8. Связанные ADR

* ADR-01 — Технологический стек
* ADR-03 — Структура каталогов
* ADR-05 — Бизнес-логика
* ADR-08 — JSON-сценарии
* ADR-14 — Extension Path

