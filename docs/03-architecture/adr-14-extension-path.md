# ADR-14 — Путь расширения архитектуры InvestCalc

Дата: 2025-01-01  
Статус: Запланировано

---

## 1. Контекст

InvestCalc задуман как учебная информационная система для:

- анализа экономической эффективности ИС,
- работы со сценариями (локальный/облачный),
- выполнения расчётов,
- автоматизации отчётности,
- командной работы.

На текущий момент система:
- stateless,
- не использует БД,
- использует только FastAPI + сервисный слой,
- хранит сценарии в JSON-файлах,
- генерирует отчёты (в перспективе),
- работает в Docker,
- имеет тесты,
- документирована через MkDocs.

Для будущих учебных групп и расширенных версий проекта может потребоваться развитие функционала.

Необходимо зафиксировать направления, в которых система может расширяться без разрушения архитектуры.

---

## 2. Решение

Принято решение определить **официальный путь расширения архитектуры InvestCalc**, включающий пять категорий:

---

## ✔ 1) Добавление базы данных (PostgreSQL / SQLite)

Переход от JSON → БД позволит хранить:

- историю расчётов,
- профили пользователей,
- сохранённые сценарии,
- результаты анализов.

Возможный переход:

```

src/database/
├── models.py (SQLAlchemy)
├── session.py
└── migrations/

```

---

## ✔ 2) Добавление полноценного UI

Фронтенд на:

- **React**
- **Next.js**
- **Vue**
- **Svelte**

С API FastAPI:

```

UI <—> API <—> Service Layer <—> Data

```

UI может включать:
- формы для ввода данных,
- визуализацию,
- графики чувствительности,
- отчёты.

---

## ✔ 3) Генерация расширенных отчётов

В дополнение к HTML:

- PDF (WeasyPrint / ReportLab),
- Excel (openpyxl),
- диаграммы (Matplotlib),
- встроенные графики (Plotly).

---

## ✔ 4) Переход к многосервисной архитектуре (микросервисы)

Потенциальное разбиение:

- **calc-service** — расчёты
- **report-service** — отчёты
- **scenario-service** — сценарии (БД)
- **api-gateway** — общий входной API

Оркестрация:
- Docker Compose
- Kubernetes (в расширенной версии)

---

## ✔ 5) Расширение DevOps

Возможные направления:

## CI/CD:
- добавление линтеров (flake8, black)
- добавление mypy
- публикация Docker-образов в GHCR

## Мониторинг:
- Prometheus
- Grafana

## Логи:
- Loki
- OpenSearch

## Deployment:
- облачный деплой (Render, Railway, Fly.io)
- деплой на VPS

---

## 3. Обоснование

## 3.1. Структура проекта уже позволяет расширение
Корневая структура (ADR-03) обеспечивает модульность:

- API слой
- бизнес-логика
- данные
- шаблоны
- тесты
- документация
- devops-папка

## 3.2. Stateless архитектура (ADR-06) — комфортная база для масштабирования
Сервис легко перенести в кластер.

## 3.3. JSON-сценарии можно заменить БД без ломки API
Связь:

```

API → Service → Repository Interface → JSON / DB

```

## 3.4. Отдельный сервисный слой позволяет разделить сервис на микросервисы
Слой бизнес-логики легко вынести в отдельный контейнер.

## 3.5. Профессиональная траектория роста проекта
InvestCalc может развиваться от учебного проекта → до полноценного аналитического сервиса.

---

## 4. Альтернативы

## 4.1. Заморозить функционал и не развивать систему
**Отклонено**

Причины:
- проект используется много лет,
- студенты разных потоков могут улучшать его,
- командная работа подразумевает развитие.

## 4.2. Переписать на другой язык
**Отклонено в рамках текущей версии**  
Но допустимо в отдельных треках (например, InvestCalc на C##).

---

## 5. Последствия

## Положительные:
- чёткая дорожная карта развития,
- удобство для будущих групп,
- архитектура остаётся гибкой и масштабируемой,
- сохранение высокого качества разработки.

## Негативные:
- расширение потребует дополнительных ADR,
- потребуется больше документации,
- возможен рост сложности системы.

---

## 6. Возможная будущая структура проекта

```plaintext
investcalc/
├── src/
│   ├── api/
│   ├── services/
│   ├── repository/       ← новый слой
│   ├── database/         ← для SQLAlchemy
│   ├── report/           ← отчёты
│   ├── ui/               ← Web UI
│   └── workers/          ← фоновые задачи
└── k8s/                  ← деплой в Kubernetes
```

---

## 7. Связанные ADR

* ADR-01 — Технологический стек
* ADR-03 — Структура каталогов
* ADR-05 — Сервисный слой
* ADR-07 — Модуль отчётности
* ADR-12 — Масштабирование
* ADR-13 — Мониторинг и логирование
 
 
 