 ADR-03 — Архитектура каталогов (Folder Structure)

Дата: 2025-01-01  
Статус: Принято

---

## 1. Контекст

При разработке учебного проекта InvestCalc требуется:
- чёткая и понятная структура каталогов,
- разделение кода на слои,
- удобство навигации для студентов,
- совместимость с FastAPI, Docker, pytest и MkDocs,
- лёгкость сопровождения и расширения.

Неправильно выбранная структура приведёт к:
- смешиванию ответственности,
- затруднениям при тестировании,
- конфликтам при командной разработке,
- проблемам с CI/CD.

Поэтому необходимо зафиксировать архитектуру каталогов как архитектурное решение.

---

## 2. Решение

Принята следующая структура каталогов проекта:

```

investcalc/
├── README.md
├── .gitignore
│
├── data/
│   ├── input-local.json
│   ├── input-cloud.json
│   └── samples/
│       ├── scenario1.json
│       └── scenario2.json
│
├── src/
│   ├── main.py
│   ├── api/
│   │   ├── **init**.py
│   │   └── v1/
│   │       ├── **init**.py
│   │       └── routes_invest.py
│   ├── models/
│   │   ├── **init**.py
│   │   └── invest.py
│   ├── services/
│   │   ├── **init**.py
│   │   └── invest_service.py
│   └── core/
│       ├── **init**.py
│       └── config.py
│
├── tests/
│   ├── test_api.py
│   ├── test_service.py
│   └── test_sensitivity.py
│
├── templates/
│   ├── template-report-practice.docx
│   ├── template-report-group-project.docx
│   ├── template-diary.docx
│   ├── template-TZ.md
│   ├── template-ADR.md
│   ├── template-test-case.md
│   └── template-bug-report.md
│
├── docs/
│   ... Полная проектная документация (ПИДИС)
│
├── devops/
│   ├── Dockerfile
│   ├── docker-compose.yml
│   ├── docker-instructions.md
│   ├── .github/workflows/build.yml
│   ├── ci-guide.md
│   ├── logging.md
│   ├── monitoring.md
│   ├── healthchecks.md
│   ├── deployment-manual.md
│   ├── backup-restore.md
│   └── db-dump-example.sql
│
├── project/
│   ├── api-skeleton/
│   ├── client-skeleton/
│   └── db/
│       └── db-schema.sql
│
├── mkdocs.yml
├── docker-compose.yml
├── Dockerfile
└── requirements.txt

```

---

## 3. Обоснование выбранной структуры

## 3.1. Чёткое разделение слоёв
Структура строго соответствует архитектурной модели:

```

API → Services → Models → Config

```

и облегчает понимание контейнерной архитектуры (C4).

## 3.2. Наличие каталога `src/`
Лучшие практики Python (FastAPI, pytest) рекомендуют располагать код в отдельной папке:
- защищает от конфликтов имён,
- облегчает импорт модулей,
- улучшает работу Docker.

## 3.3. Единое место для данных
Папка `data/` содержит:
- основные сценарии,
- тестовые входные данные,
- примеры для студентов.

Это позволяет:
- легко обновлять сценарии,
- добавлять новые варианты,
- не хранить данные внутри кода.

## 3.4. Папка `docs/` как полноценная документация
Папка интегрирована с **MkDocs**:

- поддерживает структуру учебного проекта,
- включает все документы ПИДИС,
- может публиковаться на GitHub Pages.

## 3.5. Папка `devops/`
Она содержит всё, что касается:
- Docker,
- CI/CD,
- мониторинга,
- инструкций по развёртыванию.

Это отражает лучшие практики DevOps (separation of concerns).

## 3.6. Папка `templates/`
Все учебные шаблоны вынесены в одну коллекцию:
- отчёты,
- дневники,
- ТЗ,
- ADR,
- тест-кейсы,
- баг-репорты.

Это делает проект полностью self-contained — студенты получают всё в одном месте.

---

## 4. Рассмотренные альтернативы

## 4.1. Монолитная структура (все файлы в корне)
**Отклонено**  
Причины:
- неудобно для обучения,
- сложно масштабировать,
- непрофессионально.

## 4.2. Django-подобная структура
**Отклонено**  
Причины:
- избыточно для FastAPI,
- усложняет понимание API-only структуры.

## 4.3. Микросервисная структура (много контейнеров)
**Отклонено для учебного проекта**  
Но возможно в будущем (ADR-14):
- сервис расчётов,
- сервис отчётов.

---

## 5. Последствия

## Положительные:
- чистая, прозрачная архитектура;
- удобная работа студентов с проектом;
- простая интеграция в CI/CD;
- поддержка C4-модели;
- лёгкая контейнеризация по DevOps-требованиям.

## Негативные:
- структура достаточно объёмная;
- требуется объяснение студентам (создан отдельный учебный файл).

---

## 6. Связанные ADR

- ADR-01 — Выбор технологического стека  
- ADR-02 — Стратегия развёртывания  
- ADR-04 — Использование Pydantic моделей  
- ADR-05 — Выделение сервисного слоя  
- ADR-14 — Путь расширения архитектуры  

